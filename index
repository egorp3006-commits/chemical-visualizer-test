<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Arrows under table</title>

<style>
  table { border-collapse: collapse; margin-bottom: 20px; }
  td, th { border: 1px solid #000; padding: 6px 10px; }

  /* –°—Ç—Ä—ñ–ª–∫–∏ –Ω–∞ –∫–∞–Ω–≤–∞—Å—ñ */
  #arrowsCanvas {
    width: 100%;
    height: 200px;
    border: 1px solid #aaa;
  }
</style>
</head>

<body>

<!-- üîπ –°–Æ–î–ò –í–°–¢–ê–í–õ–Ø–Ñ–® –°–í–û–Æ –¢–ê–ë–õ–ò–¶–Æ -->
<div id="tableArea">
  <!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è ‚Äî –±–∞–ª–∞–Ω—Å —Ä–µ–∞–∫—Ü—ñ—ó</title>

<style>
  :root{ --accent:#2a9df4; --pos:#1e6ed1; --neg:#d13b3b; --border:#9aa;}
  body{background:#f6f9fc; margin:0; padding:0; font-family:Arial, sans-serif;}
  .chem-wrap{max-width:1200px; margin:24px auto; background:#fff; padding:16px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.08);}
  .title{text-align:center; font-weight:700; margin-bottom:6px; font-size:20px;}
  .eq{ text-align:center; margin-bottom:12px; font-size:18px;}
  .formula-box{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; align-items:center; margin-bottom:8px;}
  .formula-part{display:inline-flex; align-items:center; gap:6px; font-weight:600;}

  table.chem{border-collapse:collapse; width:100%;}
  table.chem th, table.chem td{border:1px solid var(--border); padding:6px; text-align:center; min-width:46px; background:#fff; vertical-align:middle;}
  table.chem th{background:#e6f0fb; font-weight:700;}
  .elem-cell{background:#fafafa; font-weight:600;}
  input.num{width:100%; box-sizing:border-box; border:0; text-align:center; font-size:14px; padding:4px; background:transparent;}
  input.num:focus{outline:1px solid var(--accent); background:#eef7ff;}
  .coef{width:48px; box-sizing:border-box; padding:4px; text-align:center; border-radius:6px; border:1px solid #d7eafb; background:#f8fbff;}
  .mol-header{display:flex; flex-direction:column; gap:6px; align-items:center; justify-content:center;}
  .mol-name{font-weight:700; font-size:14px;}
  .mol-coef-label{font-size:11px; color:#555;}
  .rp-cell{min-height:36px; min-width:64px; display:flex; align-items:center; justify-content:center; background:#fff; transition:color 0.15s, background 0.15s;}
  .rp-zero{color:#333;}
  .rp-pos{color:var(--pos); font-weight:700;}
  .rp-neg{color:var(--neg); font-weight:700;}
  .note{font-size:13px; color:#555; text-align:center; margin-top:8px;}
  .mol-fallback{opacity:0.7; font-style:italic;}
  /* –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ R-P, —â–æ–± –±—É—Ç–∏ –≤ –æ–¥–∏–Ω —Ä—è–¥–æ–∫ */
  .rp-header{ white-space:nowrap; vertical-align:middle; }
  /* small screens */
  @media (max-width:880px){
    .coef{width:40px;}
    table.chem th, table.chem td{font-size:13px; padding:6px;}
    .formula-box{font-size:15px;}
  }
</style>
</head>
<body>

<div class="chem-wrap">
  <div class="title">–Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è ‚Äî –±–∞–ª–∞–Ω—Å —Ä–µ–∞–∫—Ü—ñ—ó</div>

  <div class="eq" aria-live="polite">
    <div class="formula-box" id="equation">
      <!-- –¥–∏–Ω–∞–º—ñ—á–Ω–µ —Ä—ñ–≤–Ω—è–Ω–Ω—è -->
    </div>
    <div style="font-size:13px; color:#444;">(–†–µ–∞–≥–µ–Ω—Ç–∏ –∑–ª—ñ–≤–∞ ‚Äî –ü—Ä–æ–¥—É–∫—Ç–∏ —Å–ø—Ä–∞–≤–∞)</div>
  </div>

  <!-- –Ñ–¥–∏–Ω–∞ —Ç–∞–±–ª–∏—Ü—è, —â–æ–± –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –±—É–ª–æ —Ç–æ—á–Ω–∏–º -->
  <table class="chem" id="mainTable" aria-label="–¢–∞–±–ª–∏—Ü—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —ñ –º–æ–ª–µ–∫—É–ª">
    <!-- –ì—Ä—É–ø–æ–≤–∞ —à–∞–ø–∫–∞ -->
    <thead>
      <tr>
        <th rowspan="2">–ï–ª–µ–º–µ–Ω—Ç</th>
        <th colspan="3">–†–µ–∞–≥–µ–Ω—Ç–∏</th>
        <th class="rp-header" rowspan="2">R ‚àí P</th>
        <th colspan="5">–ü—Ä–æ–¥—É–∫—Ç–∏</th>
      </tr>
      <tr id="moleculeHeaders">
        <!-- —Ç—É—Ç –±—É–¥—É—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–ª–µ–∫—É–ª (—ñ–º'—è + input –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞) -->
      </tr>
    </thead>

    <tbody id="elementsBody">
      <!-- —Ä—è–¥–∫–∏ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–∑–∞–ø–æ–≤–Ω–µ–Ω—ñ —Å–∫—Ä–∏–ø—Ç–æ–º) -->
    </tbody>
  </table>

  <div class="note">–ó–º—ñ–Ω—é–π —á–∏—Å–ª–∞ —ñ–Ω–¥–µ–∫—Å—ñ–≤ –∞–±–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ ‚Äî —Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç–∞ —Ä—ñ–∑–Ω–∏—Ü—è (R ‚àí P) –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –Ø–∫—â–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç 0 ‚Äî –º–æ–ª–µ–∫—É–ª—É –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ; 1 ‚Äî —Ü–∏—Ñ—Ä—É 1 –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ.</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è: —Å–ø–∏—Å–æ–∫ –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ —ñ –º–æ–ª–µ–∫—É–ª
  const elements = ["H","C","O","N","P","S","F","Na","Ca"];
  const reactants = [
    {id:"h2o", label:"H2O"},
    {id:"co2", label:"CO2"},
    {id:"o2",  label:"O2"}
  ];
  const products = [
    {id:"h2",   label:"H2"},
    {id:"o3",   label:"O3"},
    {id:"h2co3",label:"H2CO3"},
    {id:"n2",   label:"N2"},
    {id:"nh3",  label:"NH3"}
  ];

  // –°—Ç–≤–æ—Ä–∏–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑ –ø–æ–ª—è–º–∏ –¥–ª—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤
  const headerRow = document.getElementById("moleculeHeaders");
  function makeMolHeaderCell(mol){
    const th = document.createElement("th");
    th.innerHTML = `
      <div class="mol-header">
        <div class="mol-name" data-mol="${mol.id}" id="name_${mol.id}">${mol.label}</div>
        <div class="mol-coef-label">
          <input class="coef" aria-label="–ö–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç ${mol.id}" data-mol="${mol.id}" type="number" min="0" step="1" value="1">
        </div>
      </div>`;
    return th;
  }
  // –î–æ–¥–∞—î–º–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏
  reactants.forEach(m => headerRow.appendChild(makeMolHeaderCell(m)));
  products.forEach(m => headerRow.appendChild(makeMolHeaderCell(m)));

  // –°—Ç–≤–æ—Ä–∏–º–æ —Ç—ñ–ª–æ —Ç–∞–±–ª–∏—Ü—ñ (—Ä—è–¥–æ–∫ –Ω–∞ –∫–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç)
  const body = document.getElementById("elementsBody");
  elements.forEach(elem => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td class="elem-cell">${elem}</td>`;

    // –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ä–µ–∞–≥–µ–Ω—Ç–∞ ‚Äî input —ñ–Ω–¥–µ–∫—Å—ñ–≤
    reactants.forEach(m => {
      const td = document.createElement("td");
      td.innerHTML = `<input class="num cell left" data-mol="${m.id}" data-elem="${elem}" type="number" value="${defaultIndex(m.id, elem)}" min="0" step="1" aria-label="${m.id} ${elem}">`;
      tr.appendChild(td);
    });

    // R-P cell
    tr.innerHTML += `<td class="rp-cell" id="rp_${elem}">0</td>`;

    // –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç—É ‚Äî input —ñ–Ω–¥–µ–∫—Å—ñ–≤
    products.forEach(m => {
      const td = document.createElement("td");
      td.innerHTML = `<input class="num cell right" data-mol="${m.id}" data-elem="${elem}" type="number" value="${defaultIndex(m.id, elem)}" min="0" step="1" aria-label="${m.id} ${elem}">`;
      tr.appendChild(td);
    });

    body.appendChild(tr);
  });

  // –ó–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º (–≤—ñ–¥ –≤–∞—à–æ—ó –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Ç–∞–±–ª–∏—Ü—ñ)
  function defaultIndex(mol, elem){
    const map = {
      h2o: {H:2,O:1},
      co2: {C:1,O:2},
      o2:  {O:2},
      h2:  {H:2},
      o3:  {O:3},
      h2co3:{H:2,C:1,O:3},
      n2:  {N:2},
      nh3: {N:1,H:3}
    };
    return (map[mol] && map[mol][elem]) ? map[mol][elem] : 0;
  }

  // –î–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö input-—ñ–≤
  function qAll(selector){ return Array.from(document.querySelectorAll(selector)); }

  // –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–æ—Ä–º—É–ª—É –º–æ–ª–µ–∫—É–ª–∏ —è–∫ HTML, —á–∏—Ç–∞—é—á–∏ —ñ–Ω–¥–µ–∫—Å–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ
  // –í—Å—ñ —á–∏—Å–ª–∞ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É: –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ H2O, H2CO3, 2H2O (–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –ø–µ—Ä–µ–¥ —Ñ–æ—Ä–º—É–ª–æ—é, —Ç–µ–∂ –∑–≤–∏—á–∞–π–Ω–∏–π —Ä–æ–∑–º—ñ—Ä)
  function buildFormulaHTML(molId){
    let parts = [];
    elements.forEach(el => {
      const input = document.querySelector(`.cell[data-mol="${molId}"][data-elem="${el}"]`);
      const val = input ? Number(input.value) || 0 : 0;
      if(val > 0){
        parts.push(el + (val > 1 ? `${val}` : ""));
      }
    });
    // —è–∫—â–æ –Ω–µ–º–∞—î –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ (–≤—Å—è —Ñ–æ—Ä–º—É–ª–∞ "–ø–æ—Ä–æ–∂–Ω—è") ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏ id —è–∫ –∑–∞–ø–∞—Å
    if(parts.length === 0) return `<span class="mol-fallback">${molId}</span>`;
    return parts.join("");
  }

  // –ü–æ–±—É–¥–æ–≤–∞ —Ä—ñ–≤–Ω—è–Ω–Ω—è —É –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ (—Ä–µ–∞–≥–µ–Ω—Ç–∏ = –ø—Ä–æ–¥—É–∫—Ç–∏) ‚Äî —á–∏—Å–ª–∞ —É –∑–≤–∏—á–∞–π–Ω–æ–º—É —Ä–æ–∑–º—ñ—Ä—ñ
  function buildEquation(){
    const leftParts = [];
    reactants.forEach(m => {
      const coefInput = document.querySelector(`.coef[data-mol="${m.id}"]`);
      const coef = coefInput ? Number(coefInput.value) || 0 : 0;
      if(coef === 0) return; // –Ω–µ –ø–æ–∫–∞–∑—É—î–º–æ
      const formula = buildFormulaHTML(m.id);
      const prefix = coef > 1 ? `${coef}` : "";
      leftParts.push(prefix + formula);
    });
    const rightParts = [];
    products.forEach(m => {
      const coefInput = document.querySelector(`.coef[data-mol="${m.id}"]`);
      const coef = coefInput ? Number(coefInput.value) || 0 : 0;
      if(coef === 0) return;
      const formula = buildFormulaHTML(m.id);
      const prefix = coef > 1 ? `${coef}` : "";
      rightParts.push(prefix + formula);
    });

    const joiner = ' <span style="color:#666; font-weight:600">+</span> ';
    const leftHTML = leftParts.length ? leftParts.join(joiner) : '<span style="color:#999">‚Äî</span>';
    const rightHTML = rightParts.length ? rightParts.join(joiner) : '<span style="color:#999">‚Äî</span>';

    const eqBox = document.getElementById("equation");
    eqBox.innerHTML = `<div class="formula-part">${leftHTML}</div><div style="font-weight:700; padding:0 8px"> = </div><div class="formula-part">${rightHTML}</div>`;
  }

  // –û–±—á–∏—Å–ª–µ–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ü—ñ R - P –ø–æ –∫–æ–∂–Ω–æ–º—É –µ–ª–µ–º–µ–Ω—Ç—É —ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∏–ª—é
  function updateDifference(){
    elements.forEach(elem => {
      let leftSum = 0;
      qAll(`.left[data-elem="${elem}"]`).forEach(input => leftSum += Number(input.value) || 0);
      let rightSum = 0;
      qAll(`.right[data-elem="${elem}"]`).forEach(input => rightSum += Number(input.value) || 0);
      const diff = leftSum - rightSum;
      const cell = document.getElementById(`rp_${elem}`);
      cell.textContent = diff;
      cell.classList.remove("rp-pos","rp-neg","rp-zero");
      if(diff > 0) cell.classList.add("rp-pos");
      else if(diff < 0) cell.classList.add("rp-neg");
      else cell.classList.add("rp-zero");
    });
  }

  // –ü—Ä–∏ –∑–º—ñ–Ω—ñ –±—É–¥—å-—á–æ–≥–æ: —ñ–Ω–¥–µ–∫—Å—É –∞–±–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ ‚Äî –æ–Ω–æ–≤–ª—é—î–º–æ —Ñ–æ—Ä–º—É–ª–∏ —ñ —Ä—ñ–∑–Ω–∏—Ü—é
  function onChangeHandler(){
    // –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–∑–≤–∏ –º–æ–ª–µ–∫—É–ª –Ω–∞–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ (—â–æ–± —ñ–Ω–¥–µ–∫—Å–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –æ–¥—Ä–∞–∑—É)
    [...reactants, ...products].forEach(m => {
      const nameEl = document.getElementById(`name_${m.id}`);
      if(nameEl) nameEl.innerHTML = buildFormulaHTML(m.id);
    });

    buildEquation();
    updateDifference();
  }

  // –ü—Ä–∏–≤'—è–∑–∫–∞ –ø–æ–¥—ñ–π
  qAll("input.num").forEach(inp => inp.addEventListener("input", onChangeHandler));
  qAll("input.coef, .coef").forEach(inp => inp.addEventListener("input", onChangeHandler));

  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è: –∑–Ω–∞–π–¥–µ–º–æ –≤—Å—ñ —ñ–Ω–ø—É—Ç–∏ .coef —Ç–∞ .cell (—è–∫—ñ –º–∏ –¥–æ–¥–∞–ª–∏ –¥–∏–Ω–∞–º—ñ—á–Ω–æ) —ñ –ø—ñ–¥–≤—ñ—Å–∏–º–æ –ø–æ–¥—ñ—ó —â–µ —Ä–∞–∑
  setTimeout(() => {
    qAll("input.num").forEach(inp => inp.addEventListener("input", onChangeHandler));
    qAll("input.coef").forEach(inp => inp.addEventListener("input", onChangeHandler));
    // –í—Å—Ç–∞–Ω–æ–≤–∏–º–æ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏: —è–∫—â–æ —Ñ–æ—Ä–º—É–ª–∞ –ø–æ—Ä–æ–∂–Ω—è ‚Äî 0, —ñ–Ω–∞–∫—à–µ 1
    [...reactants, ...products].forEach(m => {
      const coef = document.querySelector(`.coef[data-mol="${m.id}"]`);
      const any = elements.some(el => Number(document.querySelector(`.cell[data-mol="${m.id}"][data-elem="${el}"]`).value) > 0);
      if(coef) coef.value = any ? coef.value || 1 : 0;
    });
    onChangeHandler();
  }, 0);

});
</script>

</body>
</html>
</div>

<!-- üîπ –ö–∞–Ω–≤–∞—Å –ü–Ü–î —Ç–∞–±–ª–∏—Ü–µ—é -->
<canvas id="arrowsCanvas"></canvas>

<script>
// ==== –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥—ñ–∫–∏ –º–∞–ª—é–≤–∞–Ω–Ω—è –æ–¥–Ω—ñ—î—ó —Å—Ç—Ä—ñ–ª–∫–∏ =====
const canvas = document.getElementById("arrowsCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  canvas.width = canvas.clientWidth;
  canvas.height = canvas.clientHeight;
}

resizeCanvas();

// –ú–∞–ª—é—î–º–æ —Å–∏–Ω—é —Å—Ç—Ä—ñ–ª–æ—á–∫—É –≤–ø—Ä–∞–≤–æ –ø—ñ–¥ —Ç–∞–±–ª–∏—Ü–µ—é
function drawArrow() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.beginPath();
  ctx.moveTo(50, 100);   // —Ç–æ—á–∫–∞ —Å—Ç–∞—Ä—Ç—É
  ctx.lineTo(200, 100);  // –∫—ñ–Ω–µ—Ü—å —Å—Ç—Ä—ñ–ª–∫–∏
  ctx.strokeStyle = "blue";
  ctx.lineWidth = 3;
  ctx.stroke();

  // –Ω–∞–∫–æ–Ω–µ—á–Ω–∏–∫
  ctx.beginPath();
  ctx.moveTo(200, 100);
  ctx.lineTo(180, 90);
  ctx.lineTo(180, 110);
  ctx.closePath();
  ctx.fillStyle = "blue";
  ctx.fill();
}

drawArrow();
</script>

</body>
</html>
